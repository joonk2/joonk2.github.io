---
title:  "SQL_5 (primary, foreign key)"
layout: post
categories: [language, sql]
tags: [sql, ì œë¡œë² ì´ìŠ¤]
toc: true
toc_sticky: true
date: 2024-03-29
---

<!-- MathJax Script for this post only -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
      processEscapes: true
    }
  });
</script>

#### ğŸ™…â€â™‚ï¸íœ´ëŒ€í°ìœ¼ë¡œ ë³¼ ë•Œ í˜¹ì‹œ ê¸€ìë‚˜ ìˆ«ìê°€ í™”ë©´ì— ë‹¤ ì•ˆë‚˜ì˜¤ë©´<span style="color:red">**,**</span> íœ´ëŒ€í° ê°€ë¡œë¡œ ëŒë¦¬ì‹œë©´ ë©ë‹ˆë‹¤

```md
<ëª©ì°¨>

1. primary key(ê¸°ë³¸í‚¤)
2. foreign key(ì™¸ë˜í‚¤)
3. ì˜ˆì œ
4. ì‹¤ìŠµ
```

<br>
ì´ë²ˆ ì‹¤ìŠµì€ sql ë¡œì»¬í™˜ê²½ìœ¼ë¡œ ì ‘ì†í•©ë‹ˆë‹¤

```python
# mysql ë¡œì»¬í™˜ê²½
cd C:\Users\withj\Documents\sql_ws
mysql -u root -p
use zerobase;
```

# 1. primary key(ê¸°ë³¸í‚¤)
- í…Œì´ë¸”ì˜ ê° ë ˆì½”ë“œë¥¼ ì‹ë³„
- ì¤‘ë³µë˜ì ì•Šì€ ê³ ìœ ê°’ì„ í¬í•¨
- NULL ê°’ì„ í¬í•¨ ëª»í•¨
- í…Œì´ë¸” ë‹¹ 1ê°œì˜ ê¸°ë³¸í‚¤
<br>

## 1-1) PRIMARY KEY ì§€ì •
```sql
CREATE TABLE í…Œì´ë¸”ëª…
(
    ì»¬ëŸ¼1 datatype NOT NULL,
    ì»¬ëŸ¼2 datatype NOT NULL,
    ...
    CONSTRAINT í”„ë¼ì´ë¨¸ë¦¬ í‚¤ ë³„ì¹­     # -------- ìƒëµ ê°€ëŠ¥ --------------------
    PRIMARY KEY (ì»¬ëŸ¼1, ì»¬ëŸ¼2, ...)
);
â¬‡ï¸
â¬‡ï¸


#-----------------  1ê°œì˜ ì»¬ëŸ¼ì„ ê¸°ë³¸í‚¤ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš° --------------------------- 
CREATE TABLE person
(
    pid int NOT NULL,
    name varchar(16),
    age int,
    sex char,
    PRIMARY KEY (pid)
);


#-----------------  2ê°œì˜ ì»¬ëŸ¼ì„ ê¸°ë³¸í‚¤ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš° ---------------------------
CREATE TABLE animal
(
    name varchar(16) NOT NULL,
    type varchar(16) NOT NULL,
    age int,
    PRIMARY KEY (name, type)
);
```

## 1-2) PRIMARY KEY ì‚­ì œ

```sql
ALTER TABLE í…Œì´ë¸”ëª…
DROP PRIMARY KEY;
â¬‡ï¸
â¬‡ï¸
# ex-1)
ALTER TABLE person
DROP PRIMARY KEY;
--------------------------------
# ex-2)
ALTER TABLE animal
DROP PRIMARY KEY;
```

## 1-3) ì´ë¯¸ ë§Œë“¤ì–´ì§„ í…Œì´ë¸”ì— PRIMARY KEY ìƒì„±

```sql
ALTER TABLE í…Œì´ë¸”ëª…
ADD PRIMARY KEY (ì»¬ëŸ¼1, ì»¬ëŸ¼2, ...)
â¬‡ï¸
â¬‡ï¸
#-----------------  1ê°œì˜ ì»¬ëŸ¼ì„ ê¸°ë³¸í‚¤ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš° --------------------------- 
ALTER TABLE person
ADD PRIMARY KEY (pid);

#-----------------  2ê°œì˜ ì»¬ëŸ¼ì„ ê¸°ë³¸í‚¤ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš° --------------------------- 
# í‚¤ ë¬¶ìŒ ì´ìœ¼ë¡œ PK_animalë¡œ ì„¤ì •
ALTER TABLE animal
ADD CONSTRAINT PK_animal
PRIMARY KEY (name, type);
```
<br><br><br><br>

# 2. foreign key(ì™¸ë˜í‚¤)
- í•œ í…Œì´ë¸”ì„ ë‹¤ë¥¸ í…Œì´ë¸”ê³¼ ì—°ê²°í•´ì£¼ëŠ” ì—­í• 
- ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ í•­ëª©ì€ ê·¸ í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ (í˜¹ì€ ë‹¨ì¼ê°’)
<br>

## 2-1) ì™œë˜í‚¤ ìƒì„±
use zerobase;
```sql
# ---------------- ê¸°ë³¸í˜• -----------------------------
CREATE TABLE í…Œì´ë¸”ëª…
(
    ì»¬ëŸ¼1 datatype NOT NULL,
    ì»¬ëŸ¼2 datatype NOT NULL,
    ì»¬ëŸ¼3 datatype,
    ì»¬ëŸ¼4 datatpye
    ...
    CONSTRAINT ê¸°ë³¸í‚¤ ë¬¶ìŒ ì´ë¦„
    PRIMARY KEY (ì»¬ëŸ¼1, ì»¬ëŸ¼2, ...),
    CONSTRAINT ì™¸ë˜í‚¤ ë¬¶ìŒ ì´ë¦„
    FOREIGN KEY (ì»¬ëŸ¼3, ì»¬ëŸ¼4, ...) REFERENCES ì°¸ì¡° í…Œì´ë¸”ëª…(ì°¸ì¡° ì»¬ëŸ¼)
);
â¬‡ï¸
â¬‡ï¸


# -------------------------- ì˜ˆì‹œ1 --------------------------------
# order í…Œì´ë¸”ì˜ pidëŠ” personí…Œì´ë¸”ì˜ pidë¥¼ ì°¸ì¡°í•œë‹¤
CREATE TABLE orders
(
    oid int NOT NULL,
    order_no varchar(16),
    pid int,
    PRIMARY KEY (oid),
    CONSTRAINT FK_person
    FOREIGN KEY (pid) REFERENCES person(pid)
);
# ëë‚˜ê³  desc orders; 
# í™•ì¸ê²°ê³¼ --> oidê°€ ê¸°ë³¸í‚¤, pidê°€ ì™¸ë˜í‚¤(MUL)



# -------------------------- ì˜ˆì‹œ2 --------------------------------
# í…Œì´ë¸” ìƒì„±ì—ì„œ ì™¸ë˜í‚¤ ì§€ì •í•  ë•Œ, constraint ìƒëµ ê°€ëŠ¥
CREATE TABLE job
(
    jid int NOT NULL,
    name varchar(16),
    pid int,
    PRIMARY KEY (jid),
    FOREIGN KEY (pid) REFERENCES person(pid)
);
# ëë‚˜ê³  desc orders; 
# í™•ì¸ê²°ê³¼ --> jidê°€ ê¸°ë³¸í‚¤, pidê°€ ì™¸ë˜í‚¤(MUL)
```

```sql
# ìë™ìƒì„±ëœ CONSTRAINT í™•ì¸
SHOW CREATE TABLE í…Œì´ë¸”ëª…;
â¬‡ï¸
show create table job;
# ì™¸ë˜í‚¤ì˜ ë³„ì¹­ í™•ì¸
#â¡ï¸ CONSTRAINT `job_ibfk_1`
```

## 2-2) ì™¸ë˜í‚¤ ì‚­ì œ
```sql
ALTER TABLE í…Œì´ë¸”ëª… DROP FOREIGN KEY ì™¸ë˜í‚¤ëª…;
â¬‡ï¸
â¬‡ï¸
ALTER TABLE orders drop foreign key FK_person;

# desc orders; 
# í™•ì¸ê²°ê³¼ ì˜ ëª¨ë¥´ê² ìŒ 

# show create table orders;
constraint í•´ì œë¨ --> KEY `FK_person` (`pid`)
```

### í…Œì´ë¸” ìƒì„± í›„ ì™¸ë˜í‚¤ ì§€ì •
```sql
ALTER TABLE í…Œì´ë¸”ëª…
ADD FOREIGN KEY (ì»¬ëŸ¼1) REFERENCES ì°¸ì¡°í…Œì´ë¸”ëª…(ì°¸ì¡°ì»¬ëŸ¼);
â¬‡ï¸
â¬‡ï¸
# order í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ pidë¡œ ì§€ì •í• ê±°ê³  person í…Œì´ë¸”ì˜ pidë¥¼ ì°¸ì¡°í•  ê²ƒì´ë‹¤
ALTER TABLE orders
ADD FOREIGN KEY (pid) REFERENCES person(pid);

# show create table job;
í™•ì¸ ê²°ê³¼ --> CONSTRAINT `job_ibfk_1`(ì™¸ë˜í‚¤ ë³„ì¹­)
```
<br><br><br>

# 3. ì˜ˆì œ
police_stationê³¼ crime_status í…Œì´ë¸” ì‚¬ì´ì— ê´€ê³„ë¥¼ ë³´ì<br>
AWS RDS(databse-1)ì˜ zerobaseì—ì„œ ì‘ì—…í•©ë‹ˆë‹¤
```sql
cd C:\Users\withj\Documents\sql_ws
aws ë¡œê·¸ì¸
use zerobase;
show tables;



# ---------------- í…Œì´ë¸” ìƒíƒœ ë¶„ì„ ------------------------------
# police_station í…Œì´ë¸”ì˜ ì»¬ëŸ¼í™•ì¸
desc police_station;

# ì¤‘ë³µì œì™¸ í•œ ì»¬ëŸ¼ì˜ ê³ ìœ ê°’ ê°¯ìˆ˜ í™•ì¸
select count(distinct ì»¬ëŸ¼ëª…) from í…Œì´ë¸”ëª…;
â¬‡ï¸
â¬‡ï¸
# police_station í…Œì´ë¸”ì˜ name ì»¬ëŸ¼ ì¤‘ë³µ ì œê±°í•˜ê³  ëª‡ê°œì¸ì§€ í™•ì¸ --> 31
select count(distinct name) from police_station;

# select count(name) from police_station; --> 124

# crime_status í…Œì´ë¸”ì˜ police_station ì»¬ëŸ¼ ì¤‘ë³µ ì œê±°í•˜ê³  ëª‡ê°œì¸ì§€ í™•ì¸
select count(distinct police_station) from crime_status;



# --------------- í…Œì´ë¸”ì´ ì„œë¡œ ë§¤ì¹­ë˜ëŠ”ì§€ í™•ì¸ -------------------------
# police_station í…Œì´ë¸”ì—ì„œ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” name ì»¬ëŸ¼ì˜ ê³ ìœ ê°’ ìƒìœ„ 3ê°œ
select distinct name from police_station limit 3;

# crime_status í…Œì´ë¸”ì—ì„œ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” police)station ì»¬ëŸ¼ì˜ ê³ ìœ ê°’ ìƒìœ„ 3ê°œ
select distinct police_station from crime_status limit 3;



# --------------------------- ë„í‘œ ì‹œê°í™” -------------------------------
# crime_status í…Œì´ë¸”ì—ì„œ police_station ì»¬ëŸ¼ì„
# police_station í…Œì´ë¸”ì—ì„œ name ì»¬ëŸ¼ì„
# ì´ì–´ ë¶™ì´ê¸°
# 2ê°œë¡œ ê·¸ë£¹í™”

select c.police_station, p.name
from crime_status c, police_station p
where p.name like concat ('ì„œìš¸', c.police_station, 'ê²½ì°°ì„œ')
group by c.police_station, p.name;
```
![Desktop View](/assets/img//language/sql/sql5/1.png)
<br><br><br><br>

# 4. ì‹¤ìŠµ
## 4-1) ë‹¤ìŒê³¼ ê°™ì´ study_idê°€ PRIMARY KEY, patient_idê°€ person í…Œì´ë¸”ì˜ pidì™€ ì—°ê²°ëœ FOREIGN KEYë¡œ ì§€ì •ëœ study í…Œì´ë¸”ì„ ìƒì„±í•˜ì„¸ìš”
![Desktop View](/assets/img//language/sql/sql4/2.png)
```sql
# mysql ë¡œì»¬í™˜ê²½
cd C:\Users\withj\Documents\sql_ws
mysql -u root -p
use zerobase;



----------------------------------------------------------
create table study
(
study_id int not null,
study_Date date,
study_time time,
patient_id int,
primary key (study_id),
constraint FK_study foreign key (patient_id) references person (pid)
);

# í…Œì´ë¸” í™•ì¸
show create table study;
```

## 4-2) ìƒì„±í•œ í…Œì´ë¸”ì˜ PRIMARY KEYë¥¼ ì‚­ì œí•˜ì„¸ìš”
```sql
# í…Œì´ë¸” í™•ì¸
desc study;

# í‚¤ ì‚­ì œ
alter table study
drop primary key;

# ë‹¤ì‹œ í…Œì´ë¸” í™•ì¸
desc study;
```

## 4-3) ìƒì„±í•œ í…Œì´ë¸”ì˜ FOREIGN KEYë¥¼ ì‚­ì œí•˜ì„¸ìš”
```sql
alter table study
drop foreign key FK_study;

# í…Œì´ë¸” ì •ë³´ í™•ì¸ 
# ë§¨ ì•„ë«ì¤„ì— foreign key ì—°ê²° í•´ì œëœ ê²ƒ í™•ì¸ ê°€ëŠ¥
show create table study;
```

## 4-4) study í…Œì´ë¸”ì˜ patient_idë¥¼ person í…Œì´ë¸”ì„ pidì™€ ì—°ê²°ëœ FOREIGN KEYë¡œ ë“±ë¡í•˜ì„¸ìš”
```sql
# í…Œì´ë¸” í™•ì¸
desc study;

# ì™¸ë˜í‚¤ ìƒì„±(person í…Œì´ë¸”ì˜ pidì»¬ëŸ¼ì„ ì°¸ì¡°) 
alter table study
add foreign key (patient_id) references person (pid);

# í…Œì´ë¸” ì •ë³´ í™•ì¸ 
# ë§¨ ì•„ë«ì¤„ì— foreign key ì—°ê²°ë¨
show create table study;
```

## 4-5) study í…Œì´ë¸”ì˜ study_idë¥¼ PRIMARY KEYë¡œ ë“±ë¡í•˜ì„¸ìš”
```sql
# í…Œì´ë¸” í™•ì¸
desc study;

# ê³ ìœ í‚¤ ìƒì„±
alter table study
add primary key (study_id);

# ë‹¤ì‹œ í…Œì´ë¸” í™•ì¸
desc study;
```