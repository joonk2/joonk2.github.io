---
title:  "SQL_3 (AWS í™œìš©)"
layout: post
categories: [language, sql]
tags: [sql, ì œë¡œë² ì´ìŠ¤]
toc: true
toc_sticky: true
date: 2024-03-27
---

<!-- MathJax Script for this post only -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
      processEscapes: true
    }
  });
</script>

#### ğŸ™…â€â™‚ï¸íœ´ëŒ€í°ìœ¼ë¡œ ë³¼ ë•Œ í˜¹ì‹œ ê¸€ìë‚˜ ìˆ«ìê°€ í™”ë©´ì— ë‹¤ ì•ˆë‚˜ì˜¤ë©´<span style="color:red">**,**</span> íœ´ëŒ€í° ê°€ë¡œë¡œ ëŒë¦¬ì‹œë©´ ë©ë‹ˆë‹¤

```md
<ëª©ì°¨>

1. AWS í™œìš©
2. SQL íŒŒì¼ ì—°ë™
3. ë°±ì—…
4. AWSì™€ ì—°ë™
5. ì‹¤ìŠµ
```

# 1. AWS í™œìš©
MySQL RDS ì™¸ë¶€ ì ‘ì†ì„ í•©ë‹ˆë‹¤ 
[http://portal.aws.amazon.com/billing/signup#/start](http://portal.aws.amazon.com/billing/signup#/start) <br>
ìš°ì„  ì´ ë§í¬ì—ì„œ íšŒì›ê°€ì…ì„ í•©ë‹ˆë‹¤. ì™„ë£Œ í›„ì—ëŠ” ì›ê²©ìœ¼ë¡œ mysql ì ‘ê·¼í•©ì‹œë‹¤
<br><br>

why? <br>
â€”> MySQL Command Line Client ë¥¼ ì‹¤í–‰í•˜ë©´ ë°”ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•´ì„œ ë¡œì»¬ì ‘ì†ìœ¼ë¡œ ë˜ê¸°ì— ëª…ë ¹í”„ë¡¬í”„íŠ¸ë¡œ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤

### cmdì°½ì— ë“¤ì–´ê°€ê¸°
![Desktop View](/assets/img/language/sql/sql3/1.png)
```bash
# ê²½ë¡œ ì´ë™
cd C:\Program Files\MySQL\MySQL Server 8.0\bin

# ë¡œê·¸ì¸
mysql - h <ì—”ë“œí¬ì¸íŠ¸> -P <í¬íŠ¸> -u <ë§ˆìŠ¤í„° ì‚¬ìš©ì ì´ë¦„> -p
â¬‡ï¸
mysql -h "ì•„ë§ˆì¡´ ê³ ìœ  ì£¼ì†Œ" -P 3306 -u admin -p

ê·¸ë¦¬ê³  ì•”í˜¸ ì…ë ¥í–ˆìŠµë‹ˆë‹¤

# í™•ì¸
show databases;

# mysql ì‚¬ìš©
use mysql;

# mysqlì˜ tables ë³´ê¸°
show tables;

# host, userë¼ëŠ” ì»¬ëŸ¼ì„ userë¼ëŠ” í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜´
select host, user from user;
```
<br><br><br><br>

# 2. SQL íŒŒì¼ ì—°ë™
```bash
# ìš°ì„  cmd ì°½ì„ ì—´ì–´ ì•„ë˜ ê²½ë¡œë¡œ ê°‘ë‹ˆë‹¤
cd C:\Users\withj\Documents

# sql_ws ë¼ëŠ” í´ë” ë§Œë“­ë‹ˆë‹¤, ê·¸ë¦¬ê³  ì´ë™
mkdir sql_ws
cd sql_ws

# vscode ì‹¤í–‰
code .

# ìƒˆíŒŒì¼ ë§Œë“¤ê¸°
test1.sql
```
<br>

## 2-1) vscodeì—ì„œ ì‘ì„±
```sql
# test1.sql

CREATE TABLE police_station
(
    name varchar(16),
    address varchar(128)
);
```

```sql
# test2.sql

CREATE TABLE crime_status
(
    year YEAR,
    police_station varchar(8),
    crime_type varchar(16),
    status_type char(2),
    case_number int
);
```
<br>

## 2-2) ctr shift `  (í„°ë¯¸ë„ ì—´ê¸°)
```sql
# vscode terminal
mysql -u root -p --default-character-set=utf8mb4

# db í™•ì¸
show databases;

# zerobase ì“°ê¸°
use zerobase;

# íŒŒì¼ ì‹¤í–‰
source ê²½ë¡œ/íŒŒì¼ëª…
â¬‡ï¸
source C:/Users/withj/Documents/sql_ws/test1.sql

# íŒŒì¼ í™•ì¸(police_station ìˆì„ ê²ƒì„)
show tables;

# ìƒˆíŒŒì¼ í™•ì¸
desc police_station;

# ë‹«ê¸°
exit;
```
<br>

### test2.sql ì¶”ê°€
```sql
# vscode í„°ë¯¸ë„ì—ì„œ mysql ë¡œê·¸ì•„ì›ƒí•˜ê¸°
exit;

# zerobaseì— test2.sql íŒŒì¼ì„ ë„£ì–´ì¤˜ë¼
GET-Content test2.sql | mysql -u root -p zerobase

# db ì‚¬ìš©í›„ crime_status í™•ì¸
use zerobase;
desc crime_status;
```
<br><br><br><br>

# 3. ë°±ì—…
ë¡œê·¸ì•„ì›ƒí•˜ê³  ì‹œì‘
```sql
#1 íŠ¹ì • db ë³µì œ
#2 ì „ì²´ db ë³µì œ
mysqldump -u ìœ ì €ëª… -p dbì´ë¦„ > íŒŒì¼ëª… --default-character-set=utf8mb4
mysqldump -u ìœ ì €ëª… -p --all-databases > íŒŒì¼ëª… --default-character-set=utf8mb4
â¬‡ï¸
# `zerobase` ë°ì´í„°ë² ì´ìŠ¤ì˜ ë‚´ìš©ì„ zerobase.sqlì— ë³µì œ(ë°±ì—…)
mysqldump -u root -p zerobase > zerobase.sql --default-character-set=utf8mb4

# íŒŒì¼ë“¤ í™•ì¸
ls
```
<br><br><br><br>

# 4. AWSì™€ ì—°ë™
`cmdì°½`
```sql
# ê²½ë¡œì´ë™
cd C:\Program Files\MySQL\MySQL Server 8.0\bin

# aws ë¡œê·¸ì¸
mysql -h "ì•„ë§ˆì¡´ ì£¼ì†Œ" -P 3306 -u admin -p

#í™•ì¸
show databases;
use zerobase;
SELECT host, user FROM mysql.user;

# adminì— ê¶Œí•œ ë¶€ì—¬
GRANT ALL PRIVILEGES ON zerobase.* TO 'admin'@'%';

# awsë¡œ ë¡œì»¬ì— ìˆë˜ zerobase dbì˜ ëª¨ë“  table ë‚´ìš©ì„ ë°±ì—…í•˜ê³  `zerobase.sql`ì— ì €ì¥ 
source zerobase.sql

# í™•ì¸
show tables;
```
<br><br><br><br>

# 5. ì‹¤ìŠµ
## 5-1) ì˜ˆì œ1
### ë¡œì»¬ì— ìˆëŠ” DB ì¤‘ 2ê°œ í…Œì´ë¸”ì¸ celab.sql, snl_showì„ ë³µì‚¬ë³¸ìœ¼ë¡œ ì¶”ì¶œ
```sql
# ê²½ë¡œì´ë™
cd C:/Users/withj/Documents/sql_ws

# `zerobase` ë°ì´í„°ë² ì´ìŠ¤ì˜ celab í…Œì´ë¸”ì„ celab.sqlì— ë³µì œ(ë°±ì—…)
# `zerobase` ë°ì´í„°ë² ì´ìŠ¤ì˜ snl_show í…Œì´ë¸”ì„ snl.sqlì— ë³µì œ(ë°±ì—…)

# celab.sql ì „ì²´ ë³µì‚¬
# snl.sql ì»¬ëŸ¼ë§Œ ë³µì‚¬
# vscode ì¢Œì¸¡ì— ë³´ë©´ celab.sql, snl.sql ìƒì„±ë¨
mysqldump -u root -p zerobase celab> celab.sql --default-character-set=utf8mb4
mysqldump -d -u root -p zerobase snl_show > snl.sql --default-character-set=utf8mb4
```
<br>

### ì•„ê¹Œ ë§Œë“  celab.sql, snl_show awsì— ë„£ê¸°
```sql
# aws ë¡œê·¸ì¸
mysql -h "ì•„ë§ˆì¡´ ì£¼ì†Œ" -P 3306 -u admin -p --default-character-set=utf8mb4

# celab ì‚­ì œ
use zerobase;
show tables;
drop table celab;

# ì „ì†¡
source celab.sql;

# ìµœì¢… í™•ì¸
show tables;
SELECT * FROM celab;
```
<br>

## 5-2) ì˜ˆì œ
```sql
# ì´ ê²½ë¡œì—ì„œ ì‹œì‘ 
cd C:\Program Files\MySQL\MySQL Server 8.0\bin
```

### (1) ë°±ì—…
zerobaseì— ìˆëŠ” ëª¨ë“  tableì„ backup_zerobase.sqlì— ë°±ì—…
```sql
mysqldump --set-gtid-purged=OFF -h "ì•„ë§ˆì¡´ì£¼ì†Œ" -P 3306 -u admin -p zerobase > backup_zerobase.sql
```

### (2) zerodbë¥¼ ë§Œë“œì„¸ìš”
```sql
# ë¨¼ì € í™•ì¸(ì¤‘ë³µ ì—¬ë¶€)
show databases;

# ìƒì„±í›„ í™•ì¸
create database zerodb default character set utf8mb4;
show databases;
```

### (3) zero@%ì— ëª¨ë“  zerodbì˜ ê¶Œí•œì„ ë¶€ì—¬í•˜ì„¸ìš”
```sql
grant all on zerodb.* to 'zero'@'%';

# zeroë¼ëŠ” ì™¸ë¶€ì ‘ì†ìì— ëŒ€í•œ ê¶Œí•œ í™•ì¸ 
show grants for 'zero'@'%';
```

### (4) ì•ì„œ ë°±ì—…í•œ zerobase ë°±ì—…íŒŒì¼ì„ zerodbì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”
```sql
# zerodb ì‚¬ìš©
use zerodb;

# table ë¹„ì—ˆëŠ”ì§€ ì°¨ìˆëŠ”ì§€ í™•ì¸
show tables;

# ë°±ì—…ë³¸.sql ìƒì„±
source backup_zerobase.sql

# ì˜ ë“¤ì–´ì™”ë‚˜ í™•ì¸
show tables;
```

### (5) police_station í…Œì´ë¸”ì— ì•„ë˜ ë°ì´í„°ë¥¼ INSERT í•˜ê¸° ìœ„í•œ SQL íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”
```sql
# ìš°ì„  vscodeì— insert.sqlì— ë“¤ì–´ê°ˆ ë‚´ìš©
(í…Œì´ë¸”ì´ë¦„: police_station)

INSERT INTO police_station VALUES('ì„œìš¸íŠ¹ë³„ì‹œê²½ì°°ì²­', 'ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ì‚¬ì§ë¡œ8ê¸¸ 31');
INSERT INTO police_station VALUES('ì„œìš¸ì¤‘ë¶€ê²½ì°°ì„œ', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ìˆ˜í‘œë¡œ 27');
INSERT INTO police_station VALUES('ì„œìš¸ì¢…ë¡œê²½ì°°ì„œ', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ìœ¨ê³¡ë¡œ 46');
INSERT INTO police_station VALUES('ì„œìš¸ë‚¨ëŒ€ë¬¸ê²½ì°°ì„œ', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ í•œê°•ëŒ€ë¡œ 410');
```

### (6) SQL íŒŒì¼ì„ ì‹¤í–‰í•˜ì—¬ AWS RDS (database-1) zerobaseì˜ police_station í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ INSERTí•˜ê³  í™•ì¸í•˜ì„¸ìš”
```sql
# ì´ë•Œê¹Œì§€ zerodbì—ì„œ ì‘ì—…ì„ í–ˆìœ¼ë‹ˆ ì´ì œ zerobaseë¡œ ì´ë™
use zerobase;
show tables;

# ë¹„ì—ˆë‚˜ í™•ì¸
SELECT * FROM police_station;

# zerodbì˜ police_station í…Œì´ë¸”ì— insert.sql ë‚´ìš©ì„ ì¶”ê°€í•  ê²ƒì„
source insert.sql;

# ì˜ ë“¤ì–´ì™”ë‚˜ í™•ì¸
SELECT * FROM police_station;
```

### (7) AWS RDS (database-1) zerobaseì˜ police_station í…Œì´ë¸”ì„ SQL íŒŒì¼ë¡œ ë°±ì—…í•˜ì„¸ìš”
```sql
# mysql ë¡œê·¸ì•„ì›ƒ
exit;

# zerobase dbì˜ police_station í…Œì´ë¸”ë§Œ ë°±ì—…ë³¸ ìƒì„±
# (vscode ì¢Œì¸¡ì— backup_police.sql ìƒì„±ë¨)
mysqldump --set-gtid-purged=OFF -h "ì•„ë§ˆì¡´ì£¼ì†Œ" -P 3306 -u admin -p zerobase police_station > backup_police.sql
```

### (8) SQL íŒŒì¼ì„ ì‹¤í–‰í•˜ì—¬ AWS RDS (database-1) zerodbì˜ police_station í…Œì´ë¸”ì„ zerobaseì™€ ë™ì¼í•˜ê²Œ ë§Œë“¤ê³  í™•ì¸í•˜ì„¸ìš”
```sql
# ë¡œê·¸ì•„ì›ƒ
exit;

# ë¡œê·¸ì¸
mysql -h "ì•„ë§ˆì¡´ ì£¼ì†Œ" -P 3306 -u admin -p --default-character-set=utf8mb4

# í™•ì¸
(police_station í…Œì´ë¸”ì— ì•„ë§ˆ ë¹„ì–´ìˆì„ ê²ë‹ˆë‹¤)
show databases;
use zerodb;
show tables;
select * from police_station;

# police_station í…Œì´ë¸”ì— data ì¶”ê°€í›„ í™•ì¸
source insert.sql;
select * from police_station;
```